
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Art Creator</title>
    <link rel="stylesheet" href="index.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007acc"/>
    <script type="module" src="index.tsx"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <a href="https://litezilla.com/" target="_blank" rel="noopener noreferrer" class="sidebar-logo-link">
                <div class="logo-container">
                    <img src="https://i.ibb.co/W4WRVhy1/off.png" alt="LiteZilla Logo" class="sidebar-logo logo-off-state">
                    <img src="https://i.ibb.co/jPTt2wND/on.png" alt="LiteZilla Logo Hover" class="sidebar-logo logo-on-state">
                </div>
            </a>

            <div class="sidebar-section" id="section-image">
                <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Image</h3>
                </div>
                <div class="sidebar-content">
                    <label for="upload-input">Upload:</label>
                    <div class="file-upload-wrapper">
                        <button class="btn file-btn">Choose File</button>
                        <span class="file-name">No file chosen...</span>
                        <input type="file" id="upload-input" accept="image/*,.pixelart">
                    </div>
                    <div class="label-with-value">
                        <label for="scale-slider">Scale:</label>
                        <span id="scale-value">100%</span>
                    </div>
                    <input type="range" id="scale-slider" min="0.1" max="5" step="0.05" value="1" disabled>
                    <div class="label-with-value">
                        <label for="color-detail-slider">Color Detail:</label>
                        <span id="color-detail-value">16</span>
                    </div>
                    <input type="range" id="color-detail-slider" min="2" max="16" step="1" value="16" disabled>
                    
                    <div class="label-with-value" style="margin-top: 15px;">
                        <label for="refine-strength-slider">Simplify:</label>
                        <span id="refine-strength-value">1</span>
                    </div>
                    <input type="range" id="refine-strength-slider" min="1" max="4" step="1" value="1" disabled>
                    <button id="apply-refinement-btn" class="btn" style="margin-top: 10px;" disabled>Apply Simplification</button>
                </div>
            </div>

            <div class="sidebar-section" id="section-tracing">
                <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Tracing Overlay</h3>
                </div>
                <div class="sidebar-content">
                    <p class="description">Upload an image to use as a transparent guide for manual tracing. The overlay moves with the canvas.</p>
                    <label for="overlay-upload-input">Overlay Image:</label>
                    <div class="file-upload-wrapper">
                        <button class="btn file-btn">Choose Image</button>
                        <span class="overlay-file-name">No file chosen...</span>
                        <input type="file" id="overlay-upload-input" accept="image/*">
                    </div>
                    <label for="overlay-opacity-slider">Opacity:</label>
                    <input type="range" id="overlay-opacity-slider" min="0" max="1" step="0.01" value="0.5" disabled>
                    <div class="button-group">
                        <button id="adjust-overlay-btn" class="btn" disabled>Adjust Overlay</button>
                        <button id="fit-to-grid-btn" class="btn" disabled>Fit to Grid</button>
                    </div>
                    <button id="clear-overlay-btn" class="btn" style="margin-top: 10px;" disabled>Clear Overlay</button>
                </div>
            </div>

            <div class="sidebar-section" id="section-size">
                 <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Size</h3>
                </div>
                <div class="sidebar-content">
                    <label for="size-select">Size:</label>
                    <select id="size-select" class="select-css">
                        <option value="16x14">16x14</option>
                        <option value="24x12">24x12</option>
                        <option value="23x23">23x23</option>
                        <option value="37x23">37x23</option>
                        <option value="51x23">51x23</option>
                        <option value="51x26" selected>51x26</option>
                        <option value="66x26">66x26</option>
                        <option value="78x26">78x26</option>
                    </select>
                </div>
            </div>

            <div class="sidebar-section" id="section-brush">
                <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Brush Tools</h3>
                </div>
                <div class="sidebar-content">
                    <label for="brush-tool-select">Brush Tool:</label>
                    <select id="brush-tool-select" class="select-css">
                        <option value="pencil">Brush</option>
                        <option value="square">Square</option>
                        <option value="circle">Circle</option>
                        <option value="bucket-area">Bucket (Area)</option>
                        <option value="bucket-global">Bucket (Global)</option>
                    </select>
                    <label for="brush-size">Brush Size:</label>
                    <input type="number" id="brush-size" value="1" min="1" class="input-css">
                    <div class="button-group">
                        <button id="undo-btn" class="btn" disabled>Undo</button>
                        <button id="redo-btn" class="btn" disabled>Redo</button>
                    </div>
                    <button id="pan-mode-btn" class="btn">Pan Mode</button>
                </div>
            </div>
            
            <div class="sidebar-section" id="section-text">
                <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Text Tool</h3>
                </div>
                <div class="sidebar-content">
                    <label for="text-input">Text:</label>
                    <input type="text" id="text-input" class="input-css" placeholder="Enter text...">
                    <label for="text-size-input">Text Size:</label>
                    <input type="number" id="text-size-input" value="1" min="1" max="5" class="input-css">
                    <button id="place-text-btn" class="btn">Add Text</button>
                </div>
            </div>

            <div class="sidebar-section" id="section-pattern">
                 <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Pattern Fill</h3>
                </div>
                <div class="sidebar-content">
                    <p class="description">Fill the background with a random geometric pattern. This feature works completely offline.</p>
                    <button id="generate-bg-btn" class="btn">Generate Background</button>
                    <button id="stroke-selection-btn" class="btn">Stroke Selection</button>
                </div>
            </div>

            <div class="sidebar-section" id="section-export">
                 <div class="sidebar-header">
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17 16.59 8.59 18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    <h3>Export</h3>
                </div>
                <div class="sidebar-content">
                    <div class="button-group">
                        <button id="save-project-btn" class="btn" disabled>Save Project</button>
                    </div>
                    <div class="button-group">
                        <button id="download-btn" class="btn" disabled>Download PNG</button>
                        <button id="download-svg-btn" class="btn" disabled>Download SVG</button>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="artboard-container">
                <div class="ruler-corner"></div>
                <canvas id="top-ruler" class="ruler"></canvas>
                <canvas id="left-ruler" class="ruler"></canvas>
                <div class="canvas-wrapper">
                    <canvas id="pixel-canvas"></canvas>
                    <canvas id="overlay-canvas"></canvas>
                </div>
            </div>
            <div class="bottom-controls">
                <div class="canvas-preview-wrapper preview-box">
                    <p>Canvas Preview</p>
                    <canvas id="canvas-preview"></canvas>
                </div>
                <div id="color-palette" class="color-palette">
                    <!-- Colors will be injected here -->
                </div>
                <div class="bottom-right-controls">
                    <div id="original-image-preview" class="original-image-preview preview-box hidden">
                        <p>Original Image</p>
                        <img id="source-image" src="" alt="Original source image">
                    </div>
                    <button id="light-effect-btn" class="icon-btn" title="Toggle Light Effect (L)">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2a7 7 0 0 0-7 7c0 3.03 1.09 5.86 3 7.85V20a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3.15C17.91 14.86 19 12.03 19 9a7 7 0 0 0-7-7z"></path>
                            <line x1="12" y1="22" x2="12" y2="20"></line>
                        </svg>
                    </button>
                    <button id="hotkey-help-btn" class="icon-btn" title="View Hotkeys">
                       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 8h4M8 12h8M10 16h4"/><rect x="3" y="4" width="18" height="16" rx="2" ry="2"/></svg>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div id="hotkey-popover" class="hotkey-popover hidden">
        <h3>Keyboard Shortcuts</h3>
        <dl class="hotkey-list">
            <dt><code>Ctrl</code> + <code>Z</code></dt><dd>Undo</dd>
            <dt><code>Ctrl</code> + <code>Y</code></dt><dd>Redo</dd>
            <dt><code>B</code></dt><dd>Brush Tool</dd>
            <dt><code>M</code></dt><dd>Square Brush</dd>
            <dt><code>Shift</code>+<code>M</code></dt><dd>Circle Brush</dd>
            <dt><code>G</code></dt><dd>Bucket (Area)</dd>
            <dt><code>Shift</code>+<code>G</code></dt><dd>Bucket (Global)</dd>
            <dt><code>H</code></dt><dd>Pan Mode</dd>
            <dt><code>L</code></dt><dd>Light Effect</dd>
            <dt><code>Shift</code>+<code>Click</code></dt><dd>Eyedropper</dd>
            <dt><code>Ctrl</code> + <code>S</code></dt><dd>Save Project</dd>
            <dt><code>Ctrl</code>+<code>Alt</code>+<code>S</code></dt><dd>Download PNG</dd>
        </dl>
    </div>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>